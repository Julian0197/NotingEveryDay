## 进程与线程

并行处理：同一时刻执行多个任务。多线程可以并行处理任务，但是线程是不能单独存在的，由进程来启动和管理。

进程：一个进程是一个程序的运行实例。启动一个程序，操作系统为这个程序创建一块内存，存放代码和运行时候的数据，和一个执行任务的主线程，整个环境叫做进程。

进程与线程的关系：
+ 进程中任一线程报错，整个进程崩溃
+ 线程之间共享进程中的数据，可以对公共数据读写
  + 联想到为什么js是单线程：如果多线程同时更改数据，会造成数据混乱
+ 进程关闭后，操作系统会回收进程中占用的内存
  + 即使任意线程中发生内存泄露，进程退出时也会被回收
  + 当程序崩溃时，关闭进程就能解决问题，因为所有内存被回收了
+ 进程之间内容相互隔离
  + 如果需要相互通信，已开IPC机制

## 多进程浏览器时代

<img src="https://pic2.zhimg.com/80/v2-a1d4c42b96218514ed6129a8cfe55bdd_1440w.webp">

最新chrome浏览器分为：1个浏览器主进程，1个GPU进程，1个网络进程，多个渲染进程和多个插件进程

+ 浏览器主进程：
  + 与其他进程一起协作，实现浏览器功能
  + 负责界面交互，比如前进、后退
  + 负责各个页面的管理，创建和销毁其他进程
  + 将渲染进程中内存中的Bitmap，绘制到用户界面上
  + 网络资源的管理和下载
+ GPU进程：最多一个，用于合成图层、3D图形绘制等
+ 渲染进程（浏览器内核）：核心是将css，html，js转化为页面，排版引擎Blink和js的v8引擎都运行在该进程中。默认情况，每个tab都会创建一个渲染进场。渲染进场出于安全考虑。都是运行在沙箱模式下。
  + tab页内的<iframe>也会占用独立的渲染进程，iframe标签可以在一个网页中嵌入另一个页面，而无需跳转网站。
  + 另外还包含GUI渲染线程，JS线程，
  + 事件触发线程（管理任务队列）：管理
  + 定时器触发线程：管理setTimeout，setInterval
  + 异步http请求线程：负责向服务器发送请求及接受响应
+ 插件进程：每个插件对应一个进程，所以插件崩溃不影响其他进程


#### 衍生问题 

1. 如今的多进程架构，我偶尔还会碰到一些由于单个页面卡死最终崩溃导致所有页面崩溃的情况，请问这是什么原因呢？

协议根域名端口号相同(same-site)情况下，会共享js执行环境，复用一个渲染进程。

2. 多进程浏览器架构对比单进程，是如何解决安全问题的？

安全沙箱相当于给进程上锁，里面的进程可以运行，但是不能在硬盘上写入任何操作，也不能在敏感位置读取任何数据。Chrome会把插件进程和渲染进程都放入安全沙箱，这样即使在渲染进程或者插件进程里面执行了恶意程序，恶意程序也无法突破沙箱去获取系统权限。
而浏览器主进程充当最高权限的进程不在沙箱之中。

